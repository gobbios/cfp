---
title: "sequenceanalysis"
author: "Christof Neumann"
date: "`r Sys.Date()`"
output: rmarkdown::pdf_document
vignette: >
  %\VignetteIndexEntry{notes on sequence analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r}
library(cfp)
```

# slope of elements

```{r, echo=FALSE, fig.height=3.5, fig.cap="\\label{fig:slopelements}Two example sequences and the slope of the occurence of A in response to position in the sequence. In the left panel the slope is steeper because A is much more likely to occur at the beginning than at the end. In the right panel, the slope is flatter, i.e. A might occur both at the beginning and at the end of the sequence."}
par(mfrow=c(1, 2))
S <- c("AAABBAABBBBB")
S <- unlist(strsplit(S, ""))
x <- data.frame(pos=1:length(S), isA=as.numeric(S=="A"))
plot(x$pos, x$isA, pch=S, xlab="position", ylab="prob of A occured", xlim=c(1,12), cex.axis=0.7, cex.lab=0.7, cex=0.7)
mod <- lm(isA ~ pos, x)
points(x$pos, predict(mod), "l", col="red", lwd=2)
mod <- glm(isA ~ pos, x, family = binomial)
points(x$pos, predict(mod, type="response"), "l", col="blue", lwd=2, lty=3)
legend(x = 1, y = 0.4, lty=c(1,3), col=c("red", "blue"), legend=c("linear", "logistic"), cex=0.5)

S <- c("AAABBAA")
S <- unlist(strsplit(S, ""))
x <- data.frame(pos=1:length(S), isA=as.numeric(S=="A"))
plot(x$pos, x$isA, pch=S, xlab="position", ylab="prob of A occured", xlim=c(1,12), cex.axis=0.7, cex.lab=0.7, cex=0.7)
mod <- lm(isA ~ pos, x)
points(x$pos, predict(mod), "l", col="red", lwd=2)
mod <- glm(isA ~ pos, x, family = binomial)
points(x$pos, predict(mod, type="response"), "l", col="blue", lwd=2, lty=3)
#legend("bottomleft", lty=c(1,3), col=c("red", "blue"), legend=c("linear", "logistic"), cex=0.5)
legend(x = 1, y = 0.4, lty=c(1,3), col=c("red", "blue"), legend=c("linear", "logistic"), cex=0.5)
```






# transition metrics

This section won't yet work with the newly-written `transitions()` function...

```{r, eval=FALSE}
templ <- as.matrix(expand.grid(letters, letters ))

# random names
testnames <- sample(authornames, 200)
# create results
res <- transitions(S = testnames[1], restemplate = templ)
res <- res[,1:2]
i=3
for(i in 1:length(testnames)) {
  tempres <- transitions(S = testnames[i], restemplate = templ)
  res <- cbind(res, round(tempres$transall, 3))
  colnames(res)[ncol(res)] <- paste0("nm", i)
}

res$RS <- rowMeans(res[, 3:ncol(res)])

res <- res[res$RS > 0, ]
res <- res[order(res$RS, decreasing = TRUE), ]
res <- res[, c("e1", "e2", "RS")]
head(res)
```



# Things to be included unary

+ composition: proportion of A calls in the sequence

+ does the seq start with an A (should be similar if not identical to transition start -> A)

+ mean call intervals 

+ N-gram distribution: two possibilities: 1) four 2-grams (AA, BB, AB, BA) or the slope sorted by value

+ transitions (normalise row-wise, and requires structure matrix!!! (which combinations are actually allowed or not))

+ Shannon entropy (1st order (proportion of A and B), and 2nd order)

# Things to be included binary

+ LD (package RecordLinkage) normalized (which would not matter in our case but maybe for others...)

+ NMI



